# 🐍 GitHub Contribution Snake Game Animation
# This workflow generates a snake eating your GitHub contributions graph
# and creates both light and dark mode versions

name: Generate Snake Animation

# Controls when the workflow will run
on:
  # Runs automatically every 12 hours
  schedule:
    - cron: "0 */12 * * *"  # Every 12 hours
  
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  
  # Runs on every push to main branch
  push:
    branches:
      - main

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow one concurrent deployment
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  generate:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      # Checkout the repository
      - name: 📥 Checkout repository
        uses: actions/checkout@v4
        
      # Generate the snake animation
      - name: 🐍 Generate snake.svg
        uses: Platane/snk/svg-only@v3
        with:
          # GitHub username
          github_user_name: ${{ github.repository_owner }}
          
          # List of files to generate (light and dark mode)
          outputs: |
            dist/github-contribution-grid-snake.svg
            dist/github-contribution-grid-snake-dark.svg?palette=github-dark
            dist/ocean.gif?color_snake=orange&color_dots=#bfd6f6,#8dbdff,#64a1f4,#4b91f1,#3c7dd9
            
      # Create output directory if it doesn't exist
      - name: 📁 Create output directory
        run: mkdir -p output
        
      # Copy generated files to output directory
      - name: 📋 Copy generated files
        run: |
          cp dist/github-contribution-grid-snake.svg output/
          cp dist/github-contribution-grid-snake-dark.svg output/
          if [ -f dist/ocean.gif ]; then
            cp dist/ocean.gif output/
          fi
          
      # Display generated files for debugging
      - name: 🔍 List generated files
        run: |
          echo "Generated files:"
          ls -la output/
          
      # Deploy to GitHub Pages
      - name: 🚀 Deploy to GitHub Pages
        uses: crazy-max/ghaction-github-pages@v4
        with:
          target_branch: output
          build_dir: output
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
      # Upload artifacts for download
      - name: 📤 Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: snake-animations
          path: output/
          retention-days: 30